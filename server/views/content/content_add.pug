extends ../layout.pug
block content
    div(class='tabBox')
    form(id="content")
        div(class="form-group")
            label 分类名称
            select(class="form-control" name='cateName')
                each item in category
                    option(value=item._id)= item.catname
        div(class="form-group")
            label 内容标题
            input(class="form-control" name='title' type="text" placeholder="请输入内容名称")
        div(class="form-group")
            label 内容简介
            input(class="form-control" name='description' type="text" placeholder="请输入内容简介")
        div(class="form-group")
            label 内容
            div(class="d-flex")
                div(class="form-control" name='content' placeholder="请输入内容" id="texts")
        button(class="btn btn-primary" id='contentAdd' type="button") 保存
    script(src="/static/js/wangEditor.min.js")
    script(src="/static/js/wangEditorConfig.js")
    script(src="/static/js/common.js")
    script.
        let $contentBox = $("#content")
        let $cateName = $contentBox.find("select[name='cateName']")
        let $title = $contentBox.find("input[name='title']")
        let $description = $contentBox.find("input[name='description']")
        let E = window.wangEditor
        let editor = new E('#texts')
         initEditor(editor)
            $("#contentAdd").on("click",function (){
                if($title.val()==''){
                    $title.after( hintErr('标题不能为空', $title))
                    $title.focus()       
                    return
                }
                if($description.val()==''){
                    $description.after(hintErr('简介不能为空', $description))
                    $description.focus()       
                    return
                }
                if(editor.txt.html()==''){
                    $content.after(hintErr('内容不能为空',  $content))
                    $content.focus()       
                    return
                }
                $.ajax({
                    type:'post',
                    url:'/content/content_add',
                    data:{
                        cateName:$cateName.val(),
                        title:$title.val(),
                        description:$description.val(),
                        content:editor.txt.html(),
                    },
                    dataType:'json',
                    success(result){
                        if(result.code==1){
                            $title.after(hintErr(result.message, $title))
                            $title.focus()       
                            return
                        }
                         if(result.code==2){
                            $description.after(hintErr(result.message, $description))
                            $description.focus()       
                            return
                        }
                         if(result.code==3){
                            $content.after(hintErr(result.message, $content))
                            $content.focus()       
                            return
                        }
                        if(result.code==4){
                            $cateName.after(hintErr(result.message,$cateName))
                            $cateName.focus()       
                            return
                        }
                         $("#contentAdd").before(alertBox(result.message+"1 秒后跳转"))
                         setTimeout(()=>{
                             window.location.href="/content"
                         },1000)
                    } 
                })
            })