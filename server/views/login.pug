<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/css/login.css">
</head>

<body>
    <div class="jumbotron jumbotron-fluid">
        <div class="loginContainer">
            <h1 class="tc-r">欢迎</h1>
            <form id="loginBox">
                <div class="form-group">
                    <label>帐号:</label>
                    <input type="text" class="form-control" name="username">
                </div>
                <div class="form-group">
                    <label>密码:</label>
                    <input type="password" class="form-control" name="password">
                </div>
                <div class="loginFlex">

                        <a href="javascript:;" class="btn btn-primary" role="button" id="loginBtn">登陆</a>
                        <a href="javascript:;" class="btn btn-danger" role="button" id="regBtn">注册</a>
                </div>
            </form>
            <form id="regBox" style="display:none">
                <div class="form-group">
                    <label>昵称:</label>
                    <input type="text" class="form-control" name="nickname">
                </div>
                <div class="form-group">
                    <label>邮箱:</label>
                    <input type="text" class="form-control" name="email">
                </div>
                <div class="form-group">
                    <label>帐号:</label>
                    <input type="text" class="form-control" name="username">
                </div>

                <div class="form-group">
                    <label>密码:</label>
                    <input type="password" class="form-control" name="password">
                </div>
                <div class="form-group">
                    <label>确认密码:</label>
                    <input type="password" class="form-control" name="passwords">
                </div>
                <div class="tc-r">
                    <a href="javascript:;" class="btn btn-primary" role="button" id="returnLogin">返回登陆</a>
                    <a href="javascript:;" class="btn btn-danger" role="button" id="regSub">注册</a>
                </div>
            </form>
        </div>
    </div>



    <div class="modal" tabindex="-1" role="dialog" id="exampleModal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">注册成功 正在返回</h5>

                </div>
            </div>
        </div>
    </div>
    <script src="/static/js/jquery-3.3.1.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    script(src="/static/js/common.js")
    script.
        let $nickname = $("#regBox").find("[name = 'nickname']"),
            $email = $("#regBox").find("[name = 'email']"),
            $username = $("#regBox").find("[name = 'username']"),
            $password = $("#regBox").find("[name = 'password']"),
            $passwords = $("#regBox").find("[name = 'passwords']"),
            $logusername = $("#loginBox").find("[name = 'username']"),
            $logpassword = $("#loginBox").find("[name = 'password']");
        $("#regBtn").on('click', () => {
            $("#loginBox").hide();
            $("#regBox").show();
        })
        $("#returnLogin").on('click', () => {
            $("#loginBox").show();
            $("#regBox").hide();
        })

        $("#regSub").on('click', () => {
            if ($nickname.val() == '') {
                $nickname.after(hintErr('请输入昵称',$nickname))
                $nickname.focus()
                return
            }

            if ($username.val() == '') {
                $username.after(hintErr('帐号不能为空',$username))
                $username.focus()
                return
            }

            if ($password.val() == '') {
                $password.after(hintErr('密码不能为空', $password))
                $password.focus()
                return
            }

            if ($passwords.val() == '') {

                $passwords.after(hintErr('确认密码不能为空',$passwords))
                $passwords.focus()
                return
            }
            
            if ($password.val() != $passwords.val()) {
                $passwords.after(hintErr('两次输入密码不一致', $passwords))
                $passwords.focus()
                return
            }
            $.ajax({
                type: 'post',
                url: '/login/user/register',
                data: {
                    nickname: $nickname.val(),
                    email: $email.val(),
                    username: $username.val(),
                    password: $password.val(),
                    passwords: $passwords.val(),
                },
                dataType: 'json',
                success(result) {
                    if (result.code == 1 || result.code == 5) {
                        $username.after(hintErr(result.message,$username))
                        $username.focus()
                        return
                    }
                    if (result.code == 2) {
                        $password.after(hintErr(result.message, $password))
                        $password.focus()
                        return
                    }
                    if (result.code == 3 || result.code == 4) {
                        $passwords.after(hintErr(result.message,$passwords))
                        $passwords.focus()
                        return
                    }
                    if (result.code == 6) {
                        $nickname.after(hintErr(result.message,$nickname))
                        $nickname.focus()
                        return
                    }
                    if (result.code == 0) {
                        $(".alert").remove()
                        $('#exampleModal').modal({
                            backdrop: 'static'
                        })
                        setTimeout(() => {
                            $('#exampleModal').modal('hide')
                            $logusername.val($username.val())
                            $logpassword.val($password.val())
                            $username.val('')
                            $password.val('')
                            $passwords.val('')
                            $("#loginBox").show();
                            $("#regBox").hide();
                        }, 1000)
                    }

                }
            })
        })

        $("#loginBtn").on('click', () => {
            $.ajax({
                type: 'post',
                url: '/login/user/login',
                data: {
                    username: $logusername.val(),
                    password: $logpassword.val()
                },
                dataType: 'json',
                success(result) {
                    if ($logusername.val() == '') {
                         if ($(".alert")) {
                                $(".alert").remove()
                            }
                        $logusername.after(hintErr('帐号不能为空', $logusername))
                        $logusername.focus()
                        return
                    }

                    if ($logpassword.val() == '') {
                        if ($(".alert")) {
                            $(".alert").remove()
                        }
                        $logpassword.after(hintErr('密码不能为空',$logpassword))
                        $logpassword.focus()
                        return
                    }
                    if (result.code == 2) {
                        if ($(".is-invalid")) {
                                $(".is-invalid").removeClass("is-invalid");
                            }
                            if ($(".invalid-feedback")) {
                                $(".invalid-feedback").remove();
                            }
                        $(".loginFlex").before(alertBox(result.message,))
                        return
                    }
                    if (result.code == 3) {
                        if ($(".is-invalid")) {
                                $(".is-invalid").removeClass("is-invalid");
                            }
                            if ($(".invalid-feedback")) {
                                $(".invalid-feedback").remove();
                            }
                        $(".loginFlex").before(alertBox(result.message))
                        return
                    }
                    setTimeout(() => {
                        window.location.href='admin';
                    }, 1000)
                }
            })
        })
</body>

</html>